{% extends "luzfcb_djdocuments/documento_validacao_base.html" %}
{% load luzfcb_djdocuments_tags %}
{% load staticfiles %}
{% load crispy_forms_tags %}

{% block form_section %}
    {% if form %}

        <div class="panel panel-info">
            <div class="panel-heading">Validar Documento</div>
            <div class="panel-body">
                <form class="form-horizontal" action="{% url 'documentos:validar' %}" method="post">
                    <fieldset>
                        <legend>Tem certeza que deseja assinar o documento "{{ object.titulo|remover_tags_html }}"
                            número: {{ object.identificador_versao }} ?</legend>
                        {% csrf_token %}
                        {% if form.errors %}
                            <div class="form-group">
                                <div class="col-sm-12">
                                    <div class="alert alert-danger alert-dismissible" role="alert">
                                        <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                                            <span aria-hidden="true">&times;</span>
                                        </button>
                                        Nome de usuário ou senha inválido, corrija-os e tente novamente.
                                    </div>
                                </div>
                            </div>
                        {% endif %}
                        <div class="form-group">

                            <label for="{{ form.assinatura_hash.id_for_label }}"
                                   class="col-sm-2 control-label">{{ form.assinatura_hash.label }}</label>
                            <div class="col-sm-10">
                                {{ form.assinatura_hash }}
                                <span id="helpBlock2"
                                      class="help-block">Selecione o usuário que irá assinar o documento</span>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="{{ form.captcha.id_for_label }}"
                                   class="col-sm-2 control-label">{{ form.captcha.label }}</label>
                            <div class="col-sm-10">
                                {{ form.captcha }}
                                <span id="helpBlock2" class="help-block">Digite a senha do usuário selecionado</span>
                            </div>

                        </div>
                        <div class="form-group">
                            <div class="col-sm-offset-2 col-sm-10">
                                <a class="btn btn-mini" onclick="refresh_captcha()"><i class="icon-refresh"></i> Refresh</a>
                                <button type="submit" class="btn btn-success">Verificar validade do Documento</button>
                            </div>
                        </div>
                    </fieldset>
                </form>

            </div>
        </div>

    {% endif %}




{% endblock form_section %}
{% block js_app %}
    {{ block.super }}
    {% if form.media %}
        {{ form.media }}
    {% endif %}

    <script>
        function refresh_captcha() {
            $.getJSON($(this).data('url'), {'refresh_captcha': 1}, function (json) {
                $('img[class="captcha"]').attr('src', json['new_cptch_image']);
                $('#id_captcha_0').val(json['new_cptch_key']);
                $('#id_captcha_1').val('');
            });
        }

    </script>
    <script src="{% static 'luzfcb_djdocuments/js/vendor/parsley/2.3.5/parsley.min.js' %}"></script>
{% endblock js_app %}


