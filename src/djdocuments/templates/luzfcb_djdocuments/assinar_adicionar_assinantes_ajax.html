{% load luzfcb_djdocuments_tags %}
{% spaceless %}
    <div class="panel panel-info">
            <div class="panel-heading">Escolha um ou mais grupos assinantes, para criar uma nova pendência de assinatura para os mesmos</div>
            <div class="panel-body">
{#                {% url 'documentos:adicionar_assinantes' slug=document_object.pk_uuid as adicionar_assinantes_url %}#}

                <form class="form-horizontal form-adicionar-assinantes" action="{{ form_action }}" method="post" id="form-adicionar-assinantes">
                    <fieldset>
                        {#                        <legend>Tem certeza que deseja assinar o documento "{{ object.assunto|remover_tags_html }}"#}
                        {#                            número: {{ object.identificador_versao }} ?</legend>#}

                        {% include "luzfcb_djdocuments/django_form_content.html" with form=form %}
{#                        <div class="form-group">#}
{#                            <div class="col-sm-offset-2 col-sm-10">#}
{#                                <button type="submit" class="btn btn-primary">Adicionar selecionados</button>#}
{#                            </div>#}
{#                        </div>#}
                    </fieldset>
                </form>

            </div>
        </div>
    <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
        <button type="button" class="btn btn-primary" form="form-adicionar-assinantes">Send message</button>
    </div>

    {{ form.media|add_defer }}
{#    <script type="application/javascript">#}
{##}
{##}
{#        (function (window, jQuery) {#}
{##}
{#            var clean_form_errors = function (serialized_array, form) {#}
{##}
{#                for (var item in serialized_array) {#}
{#                    if (serialized_array.hasOwnProperty(item)) {#}
{#                        var input_id = 'id_' + serialized_array[item].name;#}
{#                        var label_search = "label[for='" + input_id + "']";#}
{#                        $(label_search).parents('div:first').removeClass('has-error');#}
{#                        $('.autoadded', form).remove();#}
{#                    }#}
{#                }#}
{#            };#}
{##}
{#            var mark_fields_with_errors = function (errors, form) {#}
{#                for (var key in errors) {#}
{#                    if (errors.hasOwnProperty(key)) {#}
{#                        var el_text = '<p id="error_1_id_' + key + '" class="help-block autoadded"> <strong>' + errors[key] + '</strong></p>';#}
{#                        var p_element = $(el_text);#}
{#                        var input_id = 'id_' + key;#}
{#                        var label_search = "label[for='" + input_id + "']";#}
{#                        $('#hint_id_' + key, form).before(p_element);#}
{##}
{#                        $(label_search).parents('div:first').removeClass('has-error').addClass('has-error');#}
{#                    }#}
{#                }#}
{#            };#}
{#            var forms_adicionar_assinantes = jQuery('.form-adicionar-assinantes');#}
{#            $(forms_adicionar_assinantes).each(function () {#}
{#                var $formulario = $(this);#}
{#                var excluir_modal_agora = false;#}
{#                var $botao_salvar = $('button[type=submit]', $formulario);#}
{#                var modal = $formulario.parents('.modal');#}
{#                var div_modal = $formulario.parents('.div-modal');#}
{#                $botao_salvar.click(function (event) {#}
{#                    event.preventDefault();#}
{#                    $formulario.submit();#}
{##}
{#                });#}
{##}
{#                $(modal).on('hidden.bs.modal', function () {#}
{#                    var inputs = $(':input:enabled:not([readonly]):not([disabled])', $formulario);#}
{#                    clean_form_errors(inputs, $formulario);#}
{#                    if (excluir_modal_agora === true) {#}
{#                        //$(this).exclude();#}
{#                        div_modal.remove();#}
{#                        window.location.reload(true);#}
{#                    }#}
{#                });#}
{#                $(modal).on('show.bs.modal', function (event) {#}
{#                    console.log(event);#}
{#                    console.log(event.relatedTarget);#}
{##}
{#                });#}
{##}
{#                $(modal).on('shown.bs.modal', function () {#}
{##}
{##}
{#                    var first_el = $(':input:enabled:not([readonly]):not([disabled]):not(button):first', $formulario);#}
{#                    if ('select2-hidden-accessible') {#}
{##}
{#                    }#}
{#                    first_el.attr('style', 'border: 6px solid #c30000;');#}
{#                    first_el.focus();#}
{#                    console.log('passou aqui: ' + $(first_el));#}
{#                });#}
{##}
{#                $formulario.submit(function (event) {#}
{#                    // Stop form from submitting normally#}
{#                    event.preventDefault();#}
{#                    $botao_salvar.prop('disabled', true);#}
{#                    var $form = jQuery(this);#}
{#                    var conteudo = $form.serializeArray();#}
{#                    clean_form_errors(conteudo, $form);#}
{#                    var url = $form.attr("action").replace(/\s/g, "");#}
{#                    var posting = $.post(url, conteudo, 'JSON');#}
{##}
{#                    // process fail logic#}
{#                    posting.fail(function (jqXHR, textStatus, errorThrown) {#}
{##}
{#                        console.log('textStatus: ' + textStatus);#}
{#                        console.log('errorThrown:' + errorThrown);#}
{#                        var response = jqXHR.responseJSON;#}
{##}
{#                        mark_fields_with_errors(response.errors, $form);#}
{##}
{#                    });#}
{#                    // Put the results in a div#}
{#                    posting.done(function (data, textStatus, jqXHR) {#}
{##}
{#                        var a = jQuery(data);#}
{#                        console.log(data);#}
{#                        window.io = data;#}
                        {#                        console.log(a);#}
{#                        console.log("done");#}
{#                        excluir_modal_agora = true;#}
{#                        modal.modal('hide');#}
{##}
{##}
{#                    });#}
{#                    posting.always(function (data, textStatus, errorThrown) {#}
                        {#                        log_to_console("always");#}
                        {#                        requestRunning = false;#}
                        {#                        $botao_salvar.attr('')#}
{#                        $botao_salvar.prop('disabled', false);#}
{#                    });#}
{#                }).bind('ajax:complete', function () {#}
{##}
{#                    // tasks to do#}
{#                    console.log("ajax completo");#}
{##}
{##}
{#                });#}
{#            });#}
{##}
{##}
{#        })(window, jQuery);#}
{##}
{#    </script>#}
{% endspaceless %}
