{% extends "luzfcb_djdocuments/base_documentos_solar_template.html" %}
{% load staticfiles %}
{% load humanize %}
{% load luzfcb_djdocuments_tags %}
{% load spurl %}

{% block conteudo_app %}

    {% block cabecalho_pag %}
        <div class="page-title">
            <h3>
                <i class="helper-font-24 icofont-home color-blue"></i>
                Últimos Documentos
            </h3>
        </div>
    {% endblock %}

    {% block conteudo_pag %}
        <div class="row-fluid">
            <div class="span6" id="div-assinaturas">
                <p class="colorhead">
                    <span class="bold" style="font-size:16px"><i class="elusive-edit"></i> Assinaturas</span>
                    <a href="#" rel="popover" data-trigger="hover" data-html="true" data-placement="top"
                       data-content="<b>Assinaturas pendentes:</b> Documentos que exigem assinatura de uma das defensorias que seu usuário ({{ user.username }}) está vinculado"
                       data-original-title="Assinaturas de Documentos">
                        <i class="elusive-question-sign color-blue"></i>
                    </a>
                    <span class="muted">(Últimas assinaturas pendentes e assinaturas realizadas) </span>

                </p>
                <div class="box-tab corner-all">
                    <div class="box-header corner-top">
                        <ul class="nav nav-tabs">
                            <li class="active">
                                <a data-toggle="tab" data-target="#assinaturas_pendentes" rel="tooltip"
                                   data-original-title="Assinaturas pendentes">
                                    &nbsp;&nbsp;&nbsp;<i class="elusive-edit color-red"></i> Pendentes &nbsp;&nbsp;&nbsp;
                                </a>
                            </li>
                            <li class="">
                                <a data-toggle="tab" data-target="#documentos_assinados" rel="tooltip"
                                   data-original-title="Assinaturas realizadas">
                                    &nbsp;&nbsp;&nbsp;<i class="elusive-file-edit color-green"></i> Assinados &nbsp;&nbsp;&nbsp;
                                </a>
                            </li>
                        </ul>
                    </div>

                    <div class="box-body">
                        <div class="tab-content">
                            <div class="tab-pane fade active in" id="assinaturas_pendentes">
                                <table class="table table-striped table-hover table-condensed">
                                    <thead>
                                    <tr>
                                        <th class="span2">N° Documento</th>
                                        <th class="span3">Defensoria assinante</th>
                                        <th class="span3">Solicitante</th>
                                        <th class="span3">Ações</th>
                                    </tr>
                                    </thead>
                                    <tbody>

                                    {% for dado in ultimas_assinaturas_pendentes %}
                                        <tr>
                                            <td>
                                                <i class="icofont-paste color-red"></i>
                                                <a href="{{ dado.get_preview_url }}" class="btn-link" rel="popover"
                                                   data-trigger="hover"
                                                   data-placement="top" data-content="{{ dado.documento_assunto }}"
                                                   data-original-title="Doc. {{ dado.documento_identificador_versao }}">
                                                    {{ dado.documento_identificador_versao }}
                                                </a>
                                            </td>
                                            <td>
                                                <small rel="tooltip"
                                                       data-original-title="{{ dado.grupo_assinante_nome }}">
                                                    {{ dado.grupo_assinante_nome|truncatechars:36 }}
                                                </small>
                                            </td>
                                            <td>
                                                <small rel="tooltip"
                                                       data-original-title="Assinatura solicitada por {{ dado.nome_cadastrado_por }} a {{ dado.cadastrado_em|naturaltime }}">
                                                    {{ dado.nome_cadastrado_por }}
                                                </small>
                                            </td>
                                            <td>
                                                <div>
                                                    {% spurl base=dado.get_url_para_assinar query='next={{ next_success_url }}' as url_para_assinar_com_next %}
                                                    <a href="{{ url_para_assinar_com_next }}" class="btn-link">
                                                        <i class="elusive-edit color-red"></i> Assinar
                                                    </a> |
                                                    <a href="{{ dado.get_preview_url }}" class="btn-link">
                                                        <i class="icofont-search"></i> Visualizar
                                                    </a>
                                                </div>
                                            </td>
                                        </tr>
                                    {% empty %}
                                        <tr>
                                            <td colspan="4">
                                                <div class="alert alert-info text-center">
                                                    <b>Nenhuma assinatura pendente</b>
                                                </div>
                                            </td>
                                        </tr>
                                    {% endfor %}
                                    </tbody>
                                    <tfoot>
                                    <tr>
                                        <td colspan="4">

                                            <a href="{% url 'documentos:pendentes' %}" class="btn-link">
                                                <div class="alert alert-info text-center">
                                                    Ver todos <i class="icofont-arrow-right"></i>
                                                </div>
                                            </a>

                                        </td>
                                    </tr>
                                    </tfoot>
                                </table>
                            </div>

                            <div class="tab-pane fade" id="documentos_assinados">
                                <table class="table table-striped table-hover table-condensed">
                                    <thead>
                                    <tr>
                                        <th class="span2">N° Documento</th>
                                        <th class="span3">Defensoria assinante</th>
                                        <th class="span3">Assinado por</th>
                                        <th class="span1">Ações</th>
                                    </tr>
                                    </thead>
                                    <tbody>
                                    {% for dado in  ultimas_assinaturas_realizadas %}
                                        <tr>
                                            <td>
                                                <i class="elusive-file-edit color-green"></i>
                                                <a href="{{ dado.get_preview_url }}" class="btn-link" rel="popover"
                                                   data-trigger="hover"
                                                   data-placement="top" data-content="{{ dado.documento_assunto }}"
                                                   data-original-title="Doc. {{ dado.documento_identificador_versao }}">
                                                    {{ dado.documento_identificador_versao }}
                                                </a>
                                            </td>
                                            <td>
                                                <small rel="tooltip"
                                                       data-original-title="{{ dado.grupo_assinante_nome }}">
                                                    {{ dado.grupo_assinante_nome|truncatechars:36 }}
                                                </small>
                                            </td>
                                            <td>
                                                <small rel="tooltip"
                                                       data-original-title="Assinado por {{ dado.assinado_nome }} em {{ dado.assinado_em }}">
                                                    {{ dado.assinado_nome }}
                                                </small>
                                            </td>
                                            <td>
                                                <a href="{{ dado.get_preview_url }}" class="btn-link">
                                                    <i class="icofont-search"></i> Visualizar
                                                </a>
                                            </td>
                                        </tr>
                                    {% empty %}
                                        <tr>
                                            <td colspan="4">
                                                <div class="alert alert-info text-center">
                                                    <b>Nenhum documento assinado</b>
                                                </div>
                                            </td>
                                        </tr>
                                    {% endfor %}
                                    </tbody>
                                    <tfoot>
                                    <tr>
                                        <td colspan="4">

                                            <a href="{% url 'documentos:assinados' %}" class="btn-link">
                                                <div class="alert alert-info text-center">
                                                    Ver todos <i class="icofont-arrow-right"></i>
                                                </div>
                                            </a>

                                        </td>
                                    </tr>
                                    </tfoot>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="span6" id="div-finalizacao">
                <p class="colorhead">
                    <span class="bold" style="font-size:16px"><i
                            class="elusive-bell"></i> Finalização de documentos</span>
                    <a href="#" rel="popover" data-trigger="hover" data-html="true" data-placement="top"
                       data-content="<b>Finalizar documento</b> é a ação de conclusão do documento, o que impossibilita qualquer tipo de modificação de seu conteúdo, assinaturas ou assinantes."
                       data-original-title="Finalização de documentos">
                        <i class="elusive-question-sign color-blue"></i>
                    </a>
                    <span class="muted">(Últimos documentos com finalização pendente)</span>
                    <span class="pull-right"><a href="{% url 'documentos:documentos_prontos_para_finalizar' %}"
                                                class="btn-link">Ver todos <i
                            class="icofont-arrow-right"></i></a></span>

                </p>
                <div class="box-tab corner-all">
                    <div class="box-header corner-top">
                        <ul class="nav nav-tabs">
                            <li class="active">
                                <a data-toggle="tab" rel="tooltip" data-original-title="Finalização Pendente">
                                    <i class="elusive-bell color-orange"></i> Finalização Pendente
                                </a>
                            </li>
                        </ul>
                    </div>

                    <div class="box-body">
                        <div class="tab-content">
                            <div class="tab-pane fade active in">
                                <table class="table table-striped table-hover table-condensed">
                                    <thead>
                                    <tr>
                                        <th class="span2">N° Documento</th>
                                        <th class="span3">Defensoria(s) e assinante(s)</th>
                                        <th class="span1">Ações</th>
                                    </tr>
                                    </thead>
                                    <tbody>
                                    {% for dado in ultimos_documentos_nao_finalizados %}
                                        <tr>
                                            <td>
                                                <i class="icofont-paste color-blue"></i>
                                                <a href="{{ dado.get_preview_url }}" class="btn-link" rel="popover"
                                                   data-trigger="hover"
                                                   data-placement="top" data-content="{{ dado.assunto }}"
                                                   data-original-title="Doc. {{ dado.identificador_versao }}">
                                                    {{ dado.identificador_versao }}
                                                </a>
                                            </td>
                                            <td><!--Se tiver mais de um mostra a lista -->

                                                <a href="#" class="" rel="popover" data-trigger="hover"
                                                   data-html="true" data-placement="top" data-content="
                                                          <div>
                                                          <ul>
                                                            {% for assinado_nome, grupo_assinante_nome in dado.assinates_nomes %}

                                                                <li>{{ assinado_nome }}
                                                                    - {{ grupo_assinante_nome }}</li>


                                                            {% endfor %}

                                                        </ul></div>" data-original-title="Defensorias e assinantes">
                                                    <div>
                                                        <ul>
                                                            {% for assinado_nome, grupo_assinante_nome in dado.assinates_nomes %}

                                                                <li>{{ assinado_nome }}
                                                                    - {{ grupo_assinante_nome }}</li>


                                                            {% endfor %}

                                                        </ul>
                                                    </div>
                                                </a>

                                            </td>
                                            <td>
                                                {% spurl base=dado.get_finalizar_url query='next={{ next_success_url }}' as url_para_finalizar_com_next %}
                                                <a href="{{ url_para_finalizar_com_next }}" class="btn-link">
                                                    <i class="elusive-ok-circle color-green"></i> Finalizar
                                                </a> |
                                                <a href="{{ dado.get_preview_url }}" class="btn-link">
                                                    <i class="icofont-search"></i> Visualizar
                                                </a></td>
                                        </tr>
                                    {% empty %}
                                        <tr>
                                            <td colspan="4">
                                                <div class="alert alert-info text-center">
                                                    <b>Nenhum documento assinado</b>
                                                </div>
                                            </td>
                                        </tr>
                                    {% endfor %}
                                    </tbody>
                                    <tfoot>
                                    <tr>
                                        <td colspan="3">

                                            <a href="{% url 'documentos:documentos_prontos_para_finalizar' %}"
                                               class="btn-link">
                                                <div class="alert alert-info text-center">
                                                    Ver todos <i class="icofont-arrow-right"></i>
                                                </div>
                                            </a>

                                        </td>
                                    </tr>
                                    </tfoot>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="row-fluid">
            <div class="span12" id="div-documentos-recentes">
                <p class="colorhead">
                    <span class="bold" style="font-size:16px"><i class="icofont-paste"></i> Documentos recentes</span>
                    <a href="#" rel="popover" data-trigger="hover" data-html="true" data-placement="top"
                       data-content="<b>Documentos recentes:</b> são documentos modificados recentemente por uma das defensorias que seu usuário ({{ user.username }}) está vinculado"
                       data-original-title="Documentos recentes">
                        <i class="elusive-question-sign color-blue"></i>
                    </a>
                    <span class="muted">(Últimos documentos modificados) </span>
                    {#                    <span class="pull-right"><a href="#" class="btn-link">Ver todos <i class="icofont-arrow-right"></i></a></span>#}
                </p>
                <div class="well well-small bg_white">
                    <table class="table table-striped table-hover table-condensed">
                        <thead>
                        <tr>
                            <th class="span1">N° Documento</th>
                            <th class="span3">Assunto</th>
                            <th class="span3">Tipo</th>
                            <th class="span3">Defensoria</th>
                            <th class="span1">Data última edição</th>
                            <th class="span1">Ações</th>
                        </tr>
                        </thead>
                        <tbody>
                        {% for dado in  ultimos_documentos_modificados %}
                            <tr>
                                <td>
                                    <i class="icofont-paste color-purple-dark"></i>
{#                                    {% spurl base=dado.get_preview_url add_query="no_nav=1" as url_para_visualizar_com_query %}#}
{#                                    <a href="{{ url_para_visualizar_com_query }}" class="btn-link">#}
                                    <a href="{{ dado.get_preview_url }}" class="btn-link">
                                        {{ dado.identificador_versao }}
                                    </a>
                                </td>
                                <td>
                                    <small>
                                        {{ dado.assunto }}
                                    </small>
                                </td>
                                <td>
                                    <small>
                                        {{ dado.tipo_documento }}
                                    </small>
                                </td>
                                <td>
                                    <small rel="tooltip" data-original-title="{{ dado.grupo_dono }}">
                                        {{ dado.grupo_dono|truncatechars:36 }}
                                    </small>
                                </td>
                                <td>
                                    <small>
                                        {{ dado.modificado_em }}
                                    </small>
                                </td>
                                <td>
                                    {% spurl base=dado.get_preview_url query='next={{ next_success_url }}' as url_para_visualizar_com_query %}
                                    <a href="{{ url_para_visualizar_com_query }}" class="btn-link">
                                        <i class="icofont-search"></i> Visualizar
                                    </a>
                                    {% if not dado.esta_assinado %}
                                        |
                                        <a href="{{ dado.get_edit_url }}" class="btn-link">
                                            <i class="elusive-file-edit"></i> Editar
                                        </a>

                                    {% endif %}
                                </td>
                            </tr>
                        {% endfor %}
                        </tbody>
                        <tfoot>
                        <tr>
                            <td colspan="6">

                                <a href="{% url 'documentos:list' %}" class="btn-link">
                                    <div class="alert alert-info text-center">
                                        Ver todos <i class="icofont-arrow-right"></i>
                                    </div>
                                </a>

                            </td>
                        </tr>
                        </tfoot>
                    </table>
                </div>
            </div>
        </div>
    {% endblock %}

{% endblock %}
